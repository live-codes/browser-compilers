"use strict";var typescriptATA=(()=>{var y=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var z=(e,t)=>{for(var r in t)y(e,r,{get:t[r],enumerable:!0})},A=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of q(t))!K.call(e,n)&&n!==r&&y(e,n,{get:()=>t[n],enumerable:!(o=R(t,n))||o.enumerable});return e};var B=e=>A(y({},"__esModule",{value:!0}),e);var te={};z(te,{getFileTreeForModuleWithTag:()=>$,getNewDependencies:()=>x,getReferencesForModule:()=>V,setupTypeAcquisition:()=>ee});var G=Object.defineProperty,H=Object.defineProperties,J=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable,D=(e,t,r)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>{for(var r in t||(t={}))L.call(t,r)&&D(e,r,t[r]);if(T)for(var r of T(t))Q.call(t,r)&&D(e,r,t[r]);return e},W=(e,t)=>H(e,J(t)),m=(e,t,r)=>new Promise((o,n)=>{var l=a=>{try{d(r.next(a))}catch(c){n(c)}},i=a=>{try{d(r.throw(a))}catch(c){n(c)}},d=a=>a.done?o(a.value):Promise.resolve(a.value).then(l,i);d((r=r.apply(e,t)).next())}),U=(e,t)=>{let r=`https://data.jsdelivr.com/v1/package/npm/${t}`;return w(e,r,{cache:"no-store"})},X=(e,t,r)=>{let o=`https://data.jsdelivr.com/v1/package/resolve/npm/${t}@${r}`;return w(e,o)},Y=(e,t,r)=>m(void 0,null,function*(){let o=`https://data.jsdelivr.com/v1/package/npm/${t}@${r}/flat`,n=yield w(e,o);return n instanceof Error?n:W(k({},n),{moduleName:t,version:r})}),j=(e,t,r,o)=>m(void 0,null,function*(){let n=`https://cdn.jsdelivr.net/npm/${t}@${r}${o}`,i=yield(e.fetcher||fetch)(n);return i.ok?i.text():new Error("OK")});function w(e,t,r){return(e.fetcher||fetch)(t,r).then(n=>n.ok?n.json().then(l=>l):new Error("OK"))}var Z=e=>{if(["assert","assert/strict","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","diagnostics_channel","dns","dns/promises","domain","events","fs","fs/promises","http","http2","https","inspector","module","net","os","path","path/posix","path/win32","perf_hooks","process","punycode","querystring","readline","repl","stream","stream/promises","stream/consumers","stream/web","string_decoder","sys","timers","timers/promises","tls","trace_events","tty","url","util","util/types","v8","vm","wasi","worker_threads","zlib"].includes(e.replace("node:","")))return"node";let[r="",o=""]=e.split("/");return r.startsWith("@")?`${r}/${o}`:r},ee=e=>{let t=new Map,r=new Map,o=0,n=0;return i=>(o=0,n=0,l(i,0).then(d=>{var a,c;n>0&&((c=(a=e.delegate).finished)==null||c.call(a,r))}));function l(i,d){return m(this,null,function*(){var a,c,F,M,P;let b=x(e,t,i);b.forEach(s=>t.set(s.module,{state:"loading"}));let h=(yield Promise.all(b.map(s=>$(e,s.module,s.version)))).filter(s=>!("error"in s)),O=h.filter(s=>s.files.find(u=>u.name.endsWith(".d.ts"))),C=O.map(s=>E(s,`/node_modules/${s.moduleName}`)),S=h.filter(s=>!O.includes(s)),N=(yield Promise.all(S.map(s=>$(e,`@types/${g(s.moduleName)}`,"latest")))).filter(s=>!("error"in s)),I=N.map(s=>E(s,`/node_modules/@types/${g(s.moduleName).replace("types__","")}`)),_=C.concat(I).reduce((s,u)=>s.concat(u),[]);o+=_.length,_.length&&d===0&&((c=(a=e.delegate).started)==null||c.call(a));for(let s of h){let u=`/node_modules/${s.moduleName}`;N.includes(s)&&(u=`/node_modules/@types/${g(s.moduleName).replace("types__","")}`);let f=u+"/package.json",p=yield j(e,s.moduleName,s.version,"/package.json");typeof p=="string"?(r.set(f,p),(M=(F=e.delegate).receivedFile)==null||M.call(F,p,f)):(P=e.logger)==null||P.error(`Could not download package.json for ${s.moduleName}`)}yield Promise.all(_.map(s=>m(this,null,function*(){var u,f,p;let v=yield j(e,s.moduleName,s.moduleVersion,s.path);n++,v instanceof Error?(u=e.logger)==null||u.error(`Had an issue getting ${s.path} for ${s.moduleName}`):(r.set(s.vfsPath,v),(p=(f=e.delegate).receivedFile)==null||p.call(f,v,s.vfsPath),e.delegate.progress&&n%5===0&&e.delegate.progress(n,o),yield l(v,d+1))})))})}};function E(e,t){let r=[];for(let o of e.files)o.name.endsWith(".d.ts")&&r.push({moduleName:e.moduleName,moduleVersion:e.version,vfsPath:`${t}${o.name}`,path:o.name});return r}var V=(e,t)=>{let r=e.preProcessFile(t),o=e.libMap||new Map;return r.referencedFiles.concat(r.importedFiles).concat(r.libReferenceDirectives).filter(l=>!l.fileName.endsWith(".d.ts")).filter(l=>!o.has(l.fileName)).map(l=>{let i;if(!l.fileName.startsWith(".")){i="latest";let d=t.slice(l.end).split(`
`)[0];d.includes("// types:")&&(i=d.split("// types: ")[1].trim())}return{module:l.fileName,version:i}})};function x(e,t,r){return V(e.typescript,r).map(l=>W(k({},l),{module:Z(l.module)})).filter(l=>!l.module.startsWith(".")).filter(l=>!t.has(l.module))}var $=(e,t,r)=>m(void 0,null,function*(){let o=r||"latest";if(o.split(".").length<2){let l=yield X(e,t,o);if(l instanceof Error)return{error:l,userFacingMessage:`Could not go from a tag to version on npm for ${t} - possible typo?`};let i=l.version;if(!i){let d=yield U(e,t);if(d instanceof Error)return{error:l,userFacingMessage:`Could not get versions on npm for ${t} - possible typo?`};let a=Object.entries(d.tags).join(", ");return{error:new Error("Could not find tag for module"),userFacingMessage:`Could not find a tag for ${t} called ${r}. Did find ${a}`}}o=i}let n=yield Y(e,t,o);return n instanceof Error?{error:n,userFacingMessage:`Could not get the files for ${t}@${o}. Is it possibly a typo?`}:n});function g(e){return e.indexOf("@")===0&&e.indexOf("/")!==-1&&(e=e.substr(1).replace("/","__")),e}return B(te);})();
