"use strict";var typescriptATA=(()=>{var y=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var A=(e,r)=>{for(var t in r)y(e,t,{get:r[t],enumerable:!0})},B=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of K(r))!z.call(e,n)&&n!==t&&y(e,n,{get:()=>r[n],enumerable:!(o=q(r,n))||o.enumerable});return e};var G=e=>B(y({},"__esModule",{value:!0}),e);var ne={};A(ne,{getFileTreeForModuleWithTag:()=>$,getNewDependencies:()=>W,getReferencesForModule:()=>C,setupTypeAcquisition:()=>oe});var Q=Object.defineProperty,U=Object.defineProperties,X=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,j=(e,r,t)=>r in e?Q(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,x=(e,r)=>{for(var t in r||(r={}))Y.call(r,t)&&j(e,t,r[t]);if(T)for(var t of T(r))Z.call(r,t)&&j(e,t,r[t]);return e},V=(e,r)=>U(e,X(r)),m=(e,r,t)=>new Promise((o,n)=>{var l=a=>{try{d(t.next(a))}catch(c){n(c)}},i=a=>{try{d(t.throw(a))}catch(c){n(c)}},d=a=>a.done?o(a.value):Promise.resolve(a.value).then(l,i);d((t=t.apply(e,r)).next())}),ee=(e,r)=>{let t=`https://data.jsdelivr.com/v1/package/npm/${r}`;return F(e,t,{cache:"no-store"})},re=(e,r,t)=>{let o=`https://data.jsdelivr.com/v1/package/resolve/npm/${r}@${t}`;return F(e,o)},te=(e,r,t)=>m(void 0,null,function*(){let o=`https://data.jsdelivr.com/v1/package/npm/${r}@${t}/flat`,n=yield F(e,o);return n instanceof Error?n:V(x({},n),{moduleName:r,version:t})}),E=(e,r,t,o)=>m(void 0,null,function*(){let n=`https://cdn.jsdelivr.net/npm/${r}@${t}${o}`,i=yield(e.fetcher||fetch)(n);return i.ok?i.text():new Error("OK")});function F(e,r,t){return(e.fetcher||fetch)(r,t).then(n=>n.ok?n.json().then(l=>l):new Error("OK"))}var se=e=>{let r=["assert","assert/strict","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","diagnostics_channel","dns","dns/promises","domain","events","fs","fs/promises","http","http2","https","inspector","inspector/promises","module","net","os","path","path/posix","path/win32","perf_hooks","process","punycode","querystring","readline","repl","stream","stream/promises","stream/consumers","stream/web","string_decoder","sys","timers","timers/promises","tls","trace_events","tty","url","util","util/types","v8","vm","wasi","worker_threads","zlib"];if(e.indexOf("node:")===0||r.includes(e))return"node";let[t="",o=""]=e.split("/");return t.startsWith("@")?`${t}/${o}`:t},oe=e=>{let r=new Map,t=new Map,o=0,n=0;return i=>(o=0,n=0,l(i,0).then(d=>{var a,c;n>0&&((c=(a=e.delegate).finished)==null||c.call(a,t))}));function l(i,d){return m(this,null,function*(){var a,c,P,M,O;let b=W(e,r,i);b.forEach(s=>r.set(s.module,{state:"loading"}));let h=(yield Promise.all(b.map(s=>$(e,s.module,s.version)))).filter(s=>!("error"in s)),N=h.filter(s=>s.files.find(u=>w(u.name))),S=N.map(s=>k(s,`/node_modules/${s.moduleName}`)),I=h.filter(s=>!N.includes(s)),D=(yield Promise.all(I.map(s=>$(e,`@types/${g(s.moduleName)}`,"latest")))).filter(s=>!("error"in s)),R=D.map(s=>k(s,`/node_modules/@types/${g(s.moduleName).replace("types__","")}`)),_=S.concat(R).reduce((s,u)=>s.concat(u),[]);o+=_.length,_.length&&d===0&&((c=(a=e.delegate).started)==null||c.call(a));for(let s of h){let u=`/node_modules/${s.moduleName}`;D.includes(s)&&(u=`/node_modules/@types/${g(s.moduleName).replace("types__","")}`);let f=u+"/package.json",p=yield E(e,s.moduleName,s.version,"/package.json");typeof p=="string"?(t.set(f,p),(M=(P=e.delegate).receivedFile)==null||M.call(P,p,f)):(O=e.logger)==null||O.error(`Could not download package.json for ${s.moduleName}`)}yield Promise.all(_.map(s=>m(this,null,function*(){var u,f,p;let v=yield E(e,s.moduleName,s.moduleVersion,s.path);n++,v instanceof Error?(u=e.logger)==null||u.error(`Had an issue getting ${s.path} for ${s.moduleName}`):(t.set(s.vfsPath,v),(p=(f=e.delegate).receivedFile)==null||p.call(f,v,s.vfsPath),e.delegate.progress&&n%5===0&&e.delegate.progress(n,o),yield l(v,d+1))})))})}};function k(e,r){let t=[];for(let o of e.files)w(o.name)&&t.push({moduleName:e.moduleName,moduleVersion:e.version,vfsPath:`${r}${o.name}`,path:o.name});return t}var C=(e,r)=>{let t=e.preProcessFile(r),o=e.libMap||new Map;return t.referencedFiles.concat(t.importedFiles).concat(t.libReferenceDirectives).filter(l=>!w(l.fileName)).filter(l=>!o.has(l.fileName)).map(l=>{let i;if(!l.fileName.startsWith(".")){i="latest";let d=r.slice(l.end).split(`
`)[0];d.includes("// types:")&&(i=d.split("// types: ")[1].trim())}return{module:l.fileName,version:i}})};function W(e,r,t){return C(e.typescript,t).map(l=>V(x({},l),{module:se(l.module)})).filter(l=>!l.module.startsWith(".")).filter(l=>!r.has(l.module))}var $=(e,r,t)=>m(void 0,null,function*(){let o=t||"latest";if(o.split(".").length<2){let l=yield re(e,r,o);if(l instanceof Error)return{error:l,userFacingMessage:`Could not go from a tag to version on npm for ${r} - possible typo?`};let i=l.version;if(!i){let d=yield ee(e,r);if(d instanceof Error)return{error:l,userFacingMessage:`Could not get versions on npm for ${r} - possible typo?`};let a=Object.entries(d.tags).join(", ");return{error:new Error("Could not find tag for module"),userFacingMessage:`Could not find a tag for ${r} called ${t}. Did find ${a}`}}o=i}let n=yield te(e,r,o);return n instanceof Error?{error:n,userFacingMessage:`Could not get the files for ${r}@${o}. Is it possibly a typo?`}:n});function g(e){return e.indexOf("@")===0&&e.indexOf("/")!==-1&&(e=e.substr(1).replace("/","__")),e}function w(e){return/\.d\.([^\.]+\.)?[cm]?ts$/i.test(e)}return G(ne);})();
