var typescriptATA=(()=>{var N=Object.defineProperty;var R=e=>N(e,"__esModule",{value:!0});var q=(e,r)=>{R(e);for(var t in r)N(e,t,{get:r[t],enumerable:!0})};var X={};q(X,{getFileTreeForModuleWithTag:()=>g,getNewDependencies:()=>x,getReferencesForModule:()=>V,setupTypeAcquisition:()=>U});var K=Object.defineProperty,z=Object.defineProperties,A=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,D=(e,r,t)=>r in e?K(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,j=(e,r)=>{for(var t in r||(r={}))B.call(r,t)&&D(e,t,r[t]);if(T)for(var t of T(r))G.call(r,t)&&D(e,t,r[t]);return e},E=(e,r)=>z(e,A(r)),m=(e,r,t)=>new Promise((o,l)=>{var n=a=>{try{d(t.next(a))}catch(c){l(c)}},i=a=>{try{d(t.throw(a))}catch(c){l(c)}},d=a=>a.done?o(a.value):Promise.resolve(a.value).then(n,i);d((t=t.apply(e,r)).next())}),H=(e,r)=>{let t=`https://data.jsdelivr.com/v1/package/npm/${r}`;return y(e,t,{cache:"no-store"})},J=(e,r,t)=>{let o=`https://data.jsdelivr.com/v1/package/resolve/npm/${r}@${t}`;return y(e,o)},L=(e,r,t)=>m(void 0,null,function*(){let o=`https://data.jsdelivr.com/v1/package/npm/${r}@${t}/flat`,l=yield y(e,o);return l instanceof Error?l:E(j({},l),{moduleName:r,version:t})}),k=(e,r,t,o)=>m(void 0,null,function*(){let l=`https://cdn.jsdelivr.net/npm/${r}@${t}${o}`,i=yield(e.fetcher||fetch)(l);return i.ok?i.text():new Error("OK")});function y(e,r,t){return(e.fetcher||fetch)(r,t).then(l=>l.ok?l.json().then(n=>n):new Error("OK"))}var Q=e=>{if(["assert","assert/strict","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","diagnostics_channel","dns","dns/promises","domain","events","fs","fs/promises","http","http2","https","inspector","module","net","os","path","path/posix","path/win32","perf_hooks","process","punycode","querystring","readline","repl","stream","stream/promises","stream/consumers","stream/web","string_decoder","sys","timers","timers/promises","tls","trace_events","tty","url","util","util/types","v8","vm","wasi","worker_threads","zlib"].includes(e.replace("node:","")))return"node";let[t="",o=""]=e.split("/");return t.startsWith("@")?`${t}/${o}`:t},U=e=>{let r=new Map,t=new Map,o=0,l=0;return i=>(o=0,l=0,n(i,0).then(d=>{var a,c;l>0&&((c=(a=e.delegate).finished)==null||c.call(a,t))}));function n(i,d){return m(this,null,function*(){var a,c,w,F,M;let P=x(e,r,i);P.forEach(s=>r.set(s.module,{state:"loading"}));let h=(yield Promise.all(P.map(s=>g(e,s.module,s.version)))).filter(s=>!("error"in s)),b=h.filter(s=>s.files.find(u=>u.name.endsWith(".d.ts"))),C=b.map(s=>W(s,`/node_modules/${s.moduleName}`)),S=h.filter(s=>!b.includes(s)),O=(yield Promise.all(S.map(s=>g(e,`@types/${$(s.moduleName)}`,"latest")))).filter(s=>!("error"in s)),I=O.map(s=>W(s,`/node_modules/@types/${$(s.moduleName).replace("types__","")}`)),_=C.concat(I).reduce((s,u)=>s.concat(u),[]);o+=_.length,_.length&&d===0&&((c=(a=e.delegate).started)==null||c.call(a));for(let s of h){let u=`/node_modules/${s.moduleName}`;O.includes(s)&&(u=`/node_modules/@types/${$(s.moduleName).replace("types__","")}`);let f=u+"/package.json",p=yield k(e,s.moduleName,s.version,"/package.json");typeof p=="string"?(t.set(f,p),(F=(w=e.delegate).receivedFile)==null||F.call(w,p,f)):(M=e.logger)==null||M.error(`Could not download package.json for ${s.moduleName}`)}yield Promise.all(_.map(s=>m(this,null,function*(){var u,f,p;let v=yield k(e,s.moduleName,s.moduleVersion,s.path);l++,v instanceof Error?(u=e.logger)==null||u.error(`Had an issue getting ${s.path} for ${s.moduleName}`):(t.set(s.vfsPath,v),(p=(f=e.delegate).receivedFile)==null||p.call(f,v,s.vfsPath),e.delegate.progress&&l%5==0&&e.delegate.progress(l,o),yield n(v,d+1))})))})}};function W(e,r){let t=[];for(let o of e.files)o.name.endsWith(".d.ts")&&t.push({moduleName:e.moduleName,moduleVersion:e.version,vfsPath:`${r}${o.name}`,path:o.name});return t}var V=(e,r)=>{let t=e.preProcessFile(r),o=e.libMap||new Map;return t.referencedFiles.concat(t.importedFiles).concat(t.libReferenceDirectives).filter(n=>!n.fileName.endsWith(".d.ts")).filter(n=>!o.has(n.fileName)).map(n=>{let i;if(!n.fileName.startsWith(".")){i="latest";let d=r.slice(n.end).split(`
`)[0];d.includes("// types:")&&(i=d.split("// types: ")[1].trim())}return{module:n.fileName,version:i}})};function x(e,r,t){return V(e.typescript,t).map(n=>E(j({},n),{module:Q(n.module)})).filter(n=>!n.module.startsWith(".")).filter(n=>!r.has(n.module))}var g=(e,r,t)=>m(void 0,null,function*(){let o=t||"latest";if(o.split(".").length<2){let n=yield J(e,r,o);if(n instanceof Error)return{error:n,userFacingMessage:`Could not go from a tag to version on npm for ${r} - possible typo?`};let i=n.version;if(!i){let d=yield H(e,r);if(d instanceof Error)return{error:n,userFacingMessage:`Could not get versions on npm for ${r} - possible typo?`};let a=Object.entries(d.tags).join(", ");return{error:new Error("Could not find tag for module"),userFacingMessage:`Could not find a tag for ${r} called ${t}. Did find ${a}`}}o=i}let l=yield L(e,r,o);return l instanceof Error?{error:l,userFacingMessage:`Could not get the files for ${r}@${o}. Is it possibly a typo?`}:l});function $(e){return e.indexOf("@")===0&&e.indexOf("/")!==-1&&(e=e.substr(1).replace("/","__")),e}return X;})();
